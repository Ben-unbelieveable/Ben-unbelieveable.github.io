<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">
  <script>
    (function(){
      if(''){
        if (prompt('请输入文章密码') !== ''){
          alert('密码错误！');
          history.back();
        }
      }
    })();
  </script>







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="LLM,RAG," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="检索增强生成（RAG）是指对大型语言模型输出进行优化，使其能够在生成响应之前引用训练数据来源之外的权威知识库。大型语言模型（LLM）用海量数据进行训练，使用数十亿个参数为回答问题、翻译语言和完成句子等任务生成原始输出。在 LLM 本就强大的功能基础上，RAG 将其扩展为能访问特定领域或组织的内部知识库，所有这些都无需重新训练模型。这是一种经济高效地改进 LLM 输出的方法，让它在各种情境下都能保持">
<meta name="keywords" content="LLM,RAG">
<meta property="og:type" content="article">
<meta property="og:title" content="大模型-检索增强生成(RAG)">
<meta property="og:url" content="http://ben-air.cn/02.开发-25.LLM-算法知识/5022.大模型-模型优化-RAG-00.概述/index.html">
<meta property="og:site_name" content="Ben-air">
<meta property="og:description" content="检索增强生成（RAG）是指对大型语言模型输出进行优化，使其能够在生成响应之前引用训练数据来源之外的权威知识库。大型语言模型（LLM）用海量数据进行训练，使用数十亿个参数为回答问题、翻译语言和完成句子等任务生成原始输出。在 LLM 本就强大的功能基础上，RAG 将其扩展为能访问特定领域或组织的内部知识库，所有这些都无需重新训练模型。这是一种经济高效地改进 LLM 输出的方法，让它在各种情境下都能保持">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-1.png">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-2.png">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-3.png">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-4.png">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-5.png">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/07/%E9%BB%91%E7%A5%9E%E8%AF%9D_%E6%82%9F%E7%A9%BA_%E7%B4%A7%E7%AE%8D_4k%E9%AB%98%E6%B8%85%E5%A3%81%E7%BA%B8_3840x2160_%E5%BD%BC%E5%B2%B8%E5%9B%BE%E7%BD%91.jpg">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-6.png">
<meta property="og:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-7.png">
<meta property="og:updated_time" content="2026-01-06T07:45:21.500Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大模型-检索增强生成(RAG)">
<meta name="twitter:description" content="检索增强生成（RAG）是指对大型语言模型输出进行优化，使其能够在生成响应之前引用训练数据来源之外的权威知识库。大型语言模型（LLM）用海量数据进行训练，使用数十亿个参数为回答问题、翻译语言和完成句子等任务生成原始输出。在 LLM 本就强大的功能基础上，RAG 将其扩展为能访问特定领域或组织的内部知识库，所有这些都无需重新训练模型。这是一种经济高效地改进 LLM 输出的方法，让它在各种情境下都能保持">
<meta name="twitter:image" content="http://www.enmalvi.com/wp-content/uploads/2024/06/image-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ben-air.cn/02.开发-25.LLM-算法知识/5022.大模型-模型优化-RAG-00.概述/"/>





  <title>大模型-检索增强生成(RAG) | Ben-air</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ben-air</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ben-air.cn/02.开发-25.LLM-算法知识/5022.大模型-模型优化-RAG-00.概述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ben-air">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ben-air">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">大模型-检索增强生成(RAG)</h1>
        

        <div class="post-meta">
	  

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-08-14T15:29:41+08:00">
                2024-08-14
              </time>
            
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index">
                    <span itemprop="name">LLM</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/RAG/" itemprop="url" rel="index">
                    <span itemprop="name">RAG</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      
        <p>检索增强生成（RAG）是指对大型语言模型输出进行优化，使其能够在生成响应之前引用训练数据来源之外的权威知识库。大型语言模型（LLM）用海量数据进行训练，使用数十亿个参数为回答问题、翻译语言和完成句子等任务生成原始输出。在 LLM 本就强大的功能基础上，RAG 将其扩展为<strong>能访问特定领域或组织的内部知识库</strong>，所有这些都无需重新训练模型。这是一种<strong>经济高效地改进 LLM 输出的方法</strong>，让它在各种情境下都能保持相关性、准确性和实用性。<br>检索增强生成技术（Retrieval-Augmented Generation）受到了广泛关注，并被应用于各种场景，如知识库问答、法律顾问、学习助手、网站机器人等。</p>
<h1 id="RAG的优势"><a href="#RAG的优势" class="headerlink" title="RAG的优势"></a>RAG的优势</h1><h2 id="大模型面临的挑战"><a href="#大模型面临的挑战" class="headerlink" title="大模型面临的挑战"></a>大模型面临的挑战</h2><p>尽管ChatGPT和Claude等LLM展现了令人印象深刻的能力，但它们也面临着一些挑战：</p>
<ul>
<li>产生臆想的答案（幻觉）：在没有确切答案的情况下，LLM可能会产生误导性信息。</li>
<li>知识更新慢：当用户需要基于最新情况的具体响应时，LLM可能提供过时或不具体的信息。</li>
<li>知识来源缺乏引用：LLM可能引用非权威来源的信息，影响回答的准确性。</li>
<li>术语混淆：不同训练数据中相同的术语可能指向不同概念，导致LLM产生混淆。</li>
<li>领域专业知识不足： 尽管LLM拥有广泛的知识基础，但它们并不了解特定业务的细节，如公司的私有数据。</li>
</ul>
<h2 id="RAG-解决的问题"><a href="#RAG-解决的问题" class="headerlink" title="RAG 解决的问题:"></a>RAG 解决的问题:</h2><ul>
<li>避免“幻觉”问题：RAG 通过检索外部信息作为输入，获取领域特定的知识，辅助大型模型回答问题，这种方法能显著减少生成信息不准确的问题，。</li>
<li>信息的实时性： RAG 允许从外部数据源实时检索信息，RAG允许LLM访问最新的客户记录、产品规格和实时库存信息，解决知识时效性问题。</li>
<li>解决黑匣子问题：RAG技术使GenAI应用程序能够提供其使用的数据来源，增加透明度，类似于学术论文中的引用，增加回答的可追溯性。</li>
<li>数据隐私和安全： RAG 可以将知识库作为外部附件管理企业或机构的私有数据，避免数据在模型学习后以不可控的方式泄露。</li>
<li>降低应用成本：RAG提供了一种经济高效的方法，使得组织能够在不重新训练模型的情况下，提升LLM的输出质量。</li>
</ul>
<h2 id="RAG的关键优势："><a href="#RAG的关键优势：" class="headerlink" title="RAG的关键优势："></a>RAG的关键优势：</h2><ol>
<li>白盒模型的透明度和可解释性：RAG的工作流程相对透明，模块之间的关系清晰，这为模型的效果调优和可解释性提供了优势。在检索召回的内容质量不高或置信度不足时，RAG系统有能力避免生成误导性信息，选择不生成回答而非提供错误的信息。</li>
<li>成本效益和响应速度：与微调模型相比，RAG的训练周期更短，成本更低。与长文本处理相比，RAG能够提供更快速的响应和更低的推理成本。在工业界和产业应用中，成本是一个至关重要的因素，而RAG在这一点上具有明显的优势。</li>
<li>私有数据管理与安全性：RAG通过将知识库与大型模型分离，为私有数据的管理提供了一个安全的实践基础。这种方法有助于企业更好地控制和管理其知识资产，同时解决了知识依赖问题。此外，RAG底座数据库的访问权限控制和数据管理相对容易实现，而这对于大模型来说则较为困难。</li>
<li>灵活性和适应性：RAG能够适应不同的数据源和检索需求，为特定领域或任务提供定制化的解决方案。这种灵活性使RAG在多种应用场景中都能找到其适用之处。</li>
<li>模块化和可扩展性：RAG的模块化设计允许它轻松集成新模块或调整现有模块之间的交互流程，以适应不断变化的任务需求和数据环境。</li>
</ol>
<h2 id="RAG和微调方法的异同"><a href="#RAG和微调方法的异同" class="headerlink" title="RAG和微调方法的异同"></a>RAG和微调方法的异同</h2><table>
<thead>
<tr>
<th>特征比较</th>
<th>RAG</th>
<th>微调</th>
</tr>
</thead>
<tbody>
<tr>
<td>知识更新</td>
<td>直接更新检索知识库，无需重新训练。信息更新成本低，适合动态变化的数据。</td>
<td>通常需要重新训练来保持知识和数据的更新。更新成本高，适合静态数据。</td>
</tr>
<tr>
<td>外部知识</td>
<td>擅长利用外部资源，特别适合处理文档或其他结构化/非结构化数据库。</td>
<td>将外部知识学习到 LLM 内部。</td>
</tr>
<tr>
<td>数据处理</td>
<td>对数据的处理和操作要求极低。</td>
<td>依赖于构建高质量的数据集，有限的数据集可能无法显著提高性能。</td>
</tr>
<tr>
<td>模型定制</td>
<td>侧重于信息检索和融合外部知识，但可能无法充分定制模型行为或写作风格。</td>
<td>可以根据特定风格或术语调整 LLM 行为、写作风格或特定领域知识。</td>
</tr>
<tr>
<td>可解释性</td>
<td>可以追溯到具体的数据来源，有较好的可解释性和可追踪性。</td>
<td>黑盒子，可解释性相对较低。</td>
</tr>
<tr>
<td>计算资源</td>
<td>需要额外的资源来支持检索机制和数据库的维护。</td>
<td>依赖高质量的训练数据集和微调目标，对计算资源的要求较高。</td>
</tr>
<tr>
<td>推理延迟</td>
<td>增加了检索步骤的耗时</td>
<td>单纯 LLM 生成的耗时</td>
</tr>
<tr>
<td>降低幻觉</td>
<td>通过检索到的真实信息生成回答，降低了产生幻觉的概率。</td>
<td>模型学习特定领域的数据有助于减少幻觉，但面对未见过的输入时仍可能出现幻觉。</td>
</tr>
<tr>
<td>伦理隐私</td>
<td>检索和使用外部数据可能引发伦理和隐私方面的问题。</td>
<td>训练数据中的敏感信息需要妥善处理，以防泄露。</td>
</tr>
</tbody>
</table>
<h1 id="RAG-技术原理"><a href="#RAG-技术原理" class="headerlink" title="RAG 技术原理"></a>RAG 技术原理</h1><p>幻觉现象在大型语言模型（LLM）中主要因其无法访问最新信息而产生，这一问题<strong>根源于模型对其训练数据集的严重依赖</strong>。为了解决这一局限，提出了一种名为RAG（Retrieval-Augmented Generation）的方法，该方法<strong>允许LLM通过外部信息源动态地补充训练数据，从而提高回答的准确性</strong>。<br>RAG通过结合传统的检索方法和预训练的语言模型，<strong>实现了对LLM输入信息的实时更新，避免了对模型进行昂贵且耗时的微调和再训练</strong>。这种方法增强了模型的灵活性和扩展性，使其可以轻松地应用于不同的LLM，满足多样化的需求。<br>在实际应用中，RAG通过<strong>引入人类编写的现实世界数据作为信息源</strong>，不仅简化了回答生成过程，还大幅提高了生成响应的可靠性。随着技术的进步，RAG不断发展，已经能够支持<strong>检索与生成组件之间的多轮交互，通过多次迭代检索提高信息准确性</strong>，同时逐步优化生成的输出质量。<br>平台如langchain和llamaindex已经对RAG方法进行了模块化处理，这些平台通过<strong>实现多轮搜索迭代到连续生成的不同策略</strong>，提高了方法的适应性，并扩展了其在实际应用中的范围。这些创新表明，尽管各平台对RAG的具体实施方法各不相同，但它们都遵循了基本的RAG工作流程，展示了这一技术在现代AI应用中的广泛适用性和有效性。</p>
<p>一个典型的RAG应用，主要包含两个部分： 1.<strong>索引</strong> ； 2. <strong>检索与生成</strong>。</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>从<strong>源数据中加载数据并进行索引</strong>，通常离线进行，并且支持动态更新，分为：</p>
<ol>
<li><strong>加载</strong>：根据不同的数据源选择合适的加载器，加载数据得到文档。</li>
<li><strong>切片</strong>：使用文本切分器将文档切分成更小的片段，使用小片段一方面可以更好地匹配用户问题，同时也可以适应模型的有限上下文窗口。</li>
<li><strong>存储</strong>：存储和索引切片，以便在检索时能够快速找到相关的数据，通常使用 Embeddings 模型和向量数据库（VectorStore）来完成。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/06/image-1.png" alt="image"></li>
</ol>
<h2 id="检索与生成"><a href="#检索与生成" class="headerlink" title="检索与生成"></a>检索与生成</h2><p>实际的 RAG 链，接收用户问题，从索引中检索相关数据，基于问题和这些数据生成结果，分为：</p>
<ol>
<li><strong>检索</strong>：给定用户输入，使用检索器从存储中检索相关的切片。</li>
<li><strong>生成</strong>：使用包括问题和检索到的数据的提示调用 LLM 来生成答案。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/06/image-2.png" alt="image"></li>
</ol>
<h2 id="RAG系统的主要组件和工作流程"><a href="#RAG系统的主要组件和工作流程" class="headerlink" title="RAG系统的主要组件和工作流程"></a>RAG系统的主要组件和工作流程</h2><p>RAG（Retrieval-Augmented Generation，检索增强生成）系统是一个将生成式AI的优势与搜索引擎的功能相结合的复杂系统。要深入理解RAG，关键在于剖析其核心组件以及这些组件是如何协同工作的，以提供无缝的AI体验。</p>
<h3 id="检索引擎：数据的精准定位"><a href="#检索引擎：数据的精准定位" class="headerlink" title="检索引擎：数据的精准定位"></a>检索引擎：数据的精准定位</h3><p>RAG过程的首步是检索引擎的介入。这一环节涉及对庞大的信息库进行搜索，以定位与输入查询相匹配的相关数据。检索引擎运用精细的算法，确保所检索到的信息不仅相关性强，而且保持最新，为生成准确的响应打下坚实基础。</p>
<h3 id="增强引擎：上下文的深度融合"><a href="#增强引擎：上下文的深度融合" class="headerlink" title="增强引擎：上下文的深度融合"></a>增强引擎：上下文的深度融合</h3><p>检索得到的相关信息随后被送入增强引擎。这一引擎的职责是将检索到的数据与原始查询紧密结合，从而扩充上下文的深度，为生成过程奠定一个更加明智的基础。增强引擎的介入，使得生成的响应更加精准和全面。</p>
<h3 id="生成引擎：智能响应的构建"><a href="#生成引擎：智能响应的构建" class="headerlink" title="生成引擎：智能响应的构建"></a>生成引擎：智能响应的构建</h3><p>最终，经过增强的输入信息被送入生成引擎。这里，通常是利用复杂的语言模型，基于扩充后的上下文创建出既连贯又紧密相关的响应。这种响应的生成，不仅依托于模型内部的先验知识，还通过检索引擎提供的外部数据得到了显著增强。</p>
<h2 id="RAG工作流程的全景视图"><a href="#RAG工作流程的全景视图" class="headerlink" title="RAG工作流程的全景视图"></a>RAG工作流程的全景视图</h2><p>RAG的基本工作流程始于创建一个包含外部信息源的索引库。这个索引库是检索器模型的基石，它根据特定查询检索出相关的信息。在这一过程的最后阶段，生成器模型将检索到的信息与原始查询融合，形成最终的输出结果。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/06/image-3.png" alt="image"><br>RAG（Retrieval-Augmented Generation，检索增强生成）应用程序的成功依赖于一系列精心设计的步骤，确保了输出的准确性和相关性。以下是RAG系统关键步骤的深入分析。</p>
<h4 id="第一步，数据索引：构建检索的基石"><a href="#第一步，数据索引：构建检索的基石" class="headerlink" title="第一步，数据索引：构建检索的基石"></a>第一步，数据索引：构建检索的基石</h4><p>在RAG系统中，数据索引是基础。它涉及将文档分割成块，编码为向量，并存储于向量数据库中，为检索引擎提供参考点。文本规范化，包括标记化、词干提取和停用词去除，是增强文本适用性的重要步骤。深度学习技术的应用，特别是预训练的语言模型（LM），为文本生成语义向量表示，极大地提升了索引的效率和检索的精确度。</p>
<h4 id="第二步，输入查询处理：理解并转化用户需求"><a href="#第二步，输入查询处理：理解并转化用户需求" class="headerlink" title="第二步，输入查询处理：理解并转化用户需求"></a>第二步，输入查询处理：理解并转化用户需求</h4><p>用户的输入是RAG过程的起点。系统需要准确处理和理解这些输入，以形成检索引擎的搜索查询。这一步骤是确保检索结果与用户需求高度相关的关键。</p>
<h4 id="第三步，搜索和排名：找到最相关的信息"><a href="#第三步，搜索和排名：找到最相关的信息" class="headerlink" title="第三步，搜索和排名：找到最相关的信息"></a>第三步，搜索和排名：找到最相关的信息</h4><p>检索引擎根据输入查询的相关性对索引数据进行搜索和排名。利用语义相似性，检索与问题最相关的前k个块，这一步骤是RAG系统的核心，它决定了后续生成响应的质量和相关性。</p>
<h4 id="第四步，提示增强：丰富输入，提升输出"><a href="#第四步，提示增强：丰富输入，提升输出" class="headerlink" title="第四步，提示增强：丰富输入，提升输出"></a>第四步，提示增强：丰富输入，提升输出</h4><p>将检索到的最相关信息与原始查询结合，形成增强的提示。这一步骤为生成引擎提供了更丰富的信息源，有助于生成更准确和相关的响应。</p>
<h4 id="第五步，响应生成：构建最终答案"><a href="#第五步，响应生成：构建最终答案" class="headerlink" title="第五步，响应生成：构建最终答案"></a>第五步，响应生成：构建最终答案</h4><p>生成引擎结合原始问题和检索到的信息，输入LLM生成最终答案。这一步骤需要在保持与检索内容一致性和准确性的同时，引入创造性，以生成既准确又具有洞察力的文本。</p>
<h4 id="第六步，评估：持续优化的关键"><a href="#第六步，评估：持续优化的关键" class="headerlink" title="第六步，评估：持续优化的关键"></a>第六步，评估：持续优化的关键</h4><p>评估是确保RAG应用成功的最后一步。它提供了关于系统输出准确性、忠实性和响应速度的客观衡量，是持续优化RAG策略的关键环节。我们仔细看看RAG内部从索引，检索，增强到最后生成每一步都是怎么运行的，以及使用RAG和不使用RAG对返回结果的效果影响如何。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/06/image-4.png" alt="image"></p>
<h2 id="RAG范式"><a href="#RAG范式" class="headerlink" title="RAG范式"></a>RAG范式</h2><p>RAG研究范式在不断发展，我们将其分为三个阶段：Naive RAG、Advanced RAG和Modular RAG。尽管 RAG 方法具有成本效益并且超越了LLM的性能，但它们也表现出一些局限性。 Advanced RAG 和 Modular RAG 的发展正是针对 Naive RAG 的这些具体缺点的回应。</p>
<h3 id="第一阶段，朴素RAG"><a href="#第一阶段，朴素RAG" class="headerlink" title="第一阶段，朴素RAG"></a>第一阶段，朴素RAG</h3><p>Naive RAG 研究范式代表了最早的方法，在 ChatGPT 广泛采用后不久就得到了重视。Naive RAG 遵循传统的过程，包括索引、检索和生成，也被称为“检索-生成”框架，前面讲的RAG是朴素RAG，它是最基础的，最核心的架构。随着大模型落地不断深化，朴素RAG也有一些缺点：</p>
<ul>
<li><strong>检索挑战</strong>——检索阶段经常在【精确度】和【召回率】方面遇到困难，导致选择错位或不相关的块，并丢失关键信息。</li>
<li><strong>生成困难</strong>——在生成响应时，模型可能会面临幻觉问题，即生成【检索到的上下文不支持的内容】。此阶段还可能会受到输出的【不相关性、毒性或偏差】的影响，从而降低响应的质量和可靠性。</li>
<li><strong>增强障碍</strong>——将检索到的信息与不同的任务集成可能具有挑战性，有时会导致【输出脱节或不连贯】。当从多个来源检索类似信息时，该过程还可能遇到【冗余，从而导致重复响应】。确定各个段落的重要性和相关性并确保风格和语气的一致性进一步增加了复杂性。面对复杂的问题，基于原始查询的【单一检索可能不足以获取足够的上下文信息】。</li>
</ul>
<h3 id="第二阶段，高级RAG"><a href="#第二阶段，高级RAG" class="headerlink" title="第二阶段，高级RAG"></a>第二阶段，高级RAG</h3><p>Advanced RAG 引入了特定的改进来克服 Naive RAG 的局限性。它着眼于提高检索质量，采用检索前和检索后策略。为了解决索引问题，Advanced RAG 通过使用【滑动窗口方法】、【细粒度分段】和【合并元数据】来改进其索引技术。此外，它还结合了多种优化方法来简化检索过程。</p>
<p><strong>预检索过程</strong>——这一阶段的主要重点是【<strong>优化索引结构和原始查询</strong>】。优化索引的目标是提高索引内容的质量。这涉及到策略：增强数据粒度、优化索引结构、添加元数据、对齐优化、混合检索。而查询优化的目标是让用户的原始问题更清晰、更适合检索任务。常见的方法包括查询重写、查询变换、查询扩展等技术。<br><strong>检索后过程</strong>——一旦检索到相关上下文，将其与查询有效集成就至关重要。检索后过程中的主要方法包括【<strong>重新排序块和上下文压缩</strong>】。重新排列检索到的信息以将最相关的内容重新定位到提示的上下文中是一个关键策略。</p>
<h3 id="第三阶段，模块化RAG"><a href="#第三阶段，模块化RAG" class="headerlink" title="第三阶段，模块化RAG"></a>第三阶段，模块化RAG</h3><p>模块化 RAG 架构超越了前两种 RAG 范例，提供了<strong>增强的适应性和多功能性</strong>。<br>它采用了多种策略来改进其组件，例如添加用于相似性搜索的搜索模块以及通过微调来改进检索器。重组 RAG 模块等创新并重新排列 RAG 管道的引入是为了应对特定的挑战。<br>向模块化 RAG 方法的转变正在变得普遍，支持跨其组件的顺序处理和集成的端到端训练。<br>尽管具有独特性，模块化 RAG 仍建立在高级 RAG 和朴素 RAG 的基本原则之上，展示了 RAG 系列的进步和完善。</p>
<h4 id="新模块"><a href="#新模块" class="headerlink" title="新模块"></a>新模块</h4><p>模块化 RAG 框架引入了额外的<strong>专用组件来增强检索和处理能力</strong>。搜索模块适应特定场景，使用LLM生成的代码和查询语言，可以跨搜索引擎、数据库和知识图谱等各种数据源直接搜索。<br>RAG-Fusion 通过采用<strong>多查询策略</strong>将用户查询扩展到不同的视角，利用并行向量搜索和智能重新排序来揭示显式和变革性知识，从而解决了传统搜索的局限性 。<br>内存模块利用LLM的内存来指导检索，创建一个无限的内存池，通过迭代的自我增强使文本与数据分布更紧密地对齐。<br>RAG系统中的路由可导航不同的数据源，为查询选择最佳路径，无论是涉及汇总、特定数据库搜索还是合并不同的信息流 。<br>Predict模块旨在通过LLM直接生成上下文来减少冗余和噪音，确保相关性和准确性。<br>任务适配器模块根据各种下游任务定制 RAG，自动提示检索零样本输入，并通过少数样本查询生成创建特定于任务的检索器 。这种综合方法不仅简化了检索过程，而且显着提高了检索信息的质量和相关性，以更高的精度和灵活性满足了广泛的任务和查询。</p>
<h4 id="模块化-RAG-的优势"><a href="#模块化-RAG-的优势" class="headerlink" title="模块化 RAG 的优势"></a>模块化 RAG 的优势</h4><p>模块化 RAG 通过允许<strong>模块替换或重新配置来解决特定挑战</strong>，从而提供卓越的适应性。这超越了 Naive 和 Advanced RAG 的固定结构，其特点是简单的“检索”和“读取”机制。</p>
<p>此外，模块化 RAG 通过集成新模块或调整现有模块之间的交互流程来扩展这种灵活性，从而增强其在不同任务中的适用性。<br>重写-检索-读取等创新模型利用LLM的能力通过重写模块和LM反馈机制来细化检索查询来更新重写模型，从而提高任务性能。<br>类似地，像Generate-Read 用LLM生成的内容取代传统检索，而背诵阅读强调从模型权重中检索，增强模型处理知识密集型任务的能力。混合检索策略集成了关键字、语义和向量搜索来满足不同的查询。<br>此外，采用子查询和假设文档嵌入（HyDE）旨在通过关注生成的答案和真实文档之间嵌入相似性来提高检索相关性。<br>模块布局和交互的调整，例如演示-搜索-预测（DSP）框架和 ITER-RETGEN 的迭代检索-读取-检索-读取流程 ，展示了模块输出的动态使用来支持另一个模块的功能，说明了对增强模块协同作用的复杂理解。<br>Modular RAG Flow 的灵活编排展示了通过 FLARE 等技术进行自适应检索的优势 和自我 RAG 。<br>该方法超越了固定的RAG检索过程，根据不同场景评估检索的必要性。<br>灵活架构的另一个好处是RAG系统可以更轻松地与其他技术（例如微调或强化学习）集成 。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/06/image-5.png" alt="image"></p>
<p>模块化RAG的核心在于将各种<strong>功能解耦</strong>，将其作为独立的模块进行处理。具体来说，模块化RAG包括了「<strong>搜索</strong>」、「<strong>预测</strong>」、「<strong>记忆</strong>」、「<strong>评估</strong>」、「<strong>验证</strong>」和「<strong>对齐</strong>」等外层模块，以及内层的「<strong>检索</strong>」、「<strong>重排序</strong>」、「<strong>重写</strong>」和「<strong>阅读</strong>」等RAG核心过程。<br>在处理信息和响应用户查询的过程中，模块化RAG采用了多种信息处理流程。<br>例如，传统的Navie RAG模式仅包括基本的「检索」和「阅读」步骤。<br>而在更复杂的Advanced RAG模式中，包括了「重写」→「检索」→「重排序」→「阅读」的路径，这在提高检索和生成内容的质量方面尤为有效。<br>DSP（Demonstrate-Search-Predict）模式则专注于验证、搜索和预测阶段，这些模块和模式的组合赋予了模块化RAG极大的灵活性和适应性，使其成为一种强大且可扩展的工具，能够有效地应对各种信息处理挑战，并在多样化的应用场景中提供高质量的回答。</p>
<h1 id="RAG-场景对向量数据库的需求"><a href="#RAG-场景对向量数据库的需求" class="headerlink" title="RAG 场景对向量数据库的需求"></a>RAG 场景对向量数据库的需求</h1><p>而检索系统对向量数据库的需求可以抽象描述为：</p>
<ul>
<li>高精度的召回：向量数据库需要能够准确召回与查询语义最相关的文档或信息片段。这要求数据库能够理解和处理高维向量空间中的复杂语义关系，确保召回内容与查询的高度相关性。这里的效果既包括向量检索的数学召回精度也包括嵌入模型的语义精度。</li>
<li>快速响应：为了不影响用户体验，召回操作需要在极短的时间内完成，通常是毫秒级别。这要求向量数据库具备高效的查询处理能力，以快速从大规模数据集中检索和召回信息。此外，随着数据量的增长和查询需求的变化，向量数据库需要能够灵活扩展，以支持更多的数据和更复杂的查询，同时保持召回效果的稳定性和可靠性。</li>
<li>处理多模态数据的能力：随着应用场景的多样化，向量数据库可能需要处理不仅仅是文本，还有图像、视频等多模态数据。这要求数据库能够支持不同种类数据的嵌入，并能根据不同模态的数据查询进行有效的召回。</li>
<li>可解释性和可调试性：在召回效果不理想时，能够提供足够的信息帮助开发者诊断和优化是非常有价值的。因此，向量数据库在设计时也应考虑到系统的可解释性和可调试性。<h2 id="可选的向量数据库"><a href="#可选的向量数据库" class="headerlink" title="可选的向量数据库"></a>可选的向量数据库</h2><h3 id="Pinecone"><a href="#Pinecone" class="headerlink" title="Pinecone"></a><a href="pinecone.io">Pinecone</a></h3></li>
</ul>
<h3 id="Weaviate"><a href="#Weaviate" class="headerlink" title="Weaviate"></a><a href="weaviate.io">Weaviate</a></h3><h3 id="Qdrant"><a href="#Qdrant" class="headerlink" title="Qdrant"></a><a href="qdrant.tech">Qdrant</a></h3><h3 id="Milvus-Zilliz"><a href="#Milvus-Zilliz" class="headerlink" title="Milvus/Zilliz"></a><a href="milvus.io">Milvus</a>/<a href="zilliz.com">Zilliz</a></h3><h3 id="Chroma"><a href="#Chroma" class="headerlink" title="Chroma"></a><a href="trychroma.com">Chroma</a></h3><h3 id="LanceDB"><a href="#LanceDB" class="headerlink" title="LanceDB"></a><a href="lancedb.com">LanceDB</a></h3><h3 id="Vespa"><a href="#Vespa" class="headerlink" title="Vespa"></a><a href="vespa.ai">Vespa</a></h3><h2 id="什么是Embedding"><a href="#什么是Embedding" class="headerlink" title="什么是Embedding"></a>什么是Embedding</h2><p>矢量数据库不仅存储原始数据（可以是图像、音频或文本），还存储其编码形式：<strong>Embedding</strong>。<br>这些 <strong>Embedding</strong> 本质上是存储数据上下文表示的数字（即 <strong>vector</strong> ）列表。直观上，当我们提到 <strong>Embedding</strong> 时，我们谈论的是实际存在于更高维度的数据（图像、文本、音频）的压缩、低维表示。</p>
<p>Embedding基于一个技巧：获取一段内容（文字，图片，视频…..）并将该内容转换为浮点数数组。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/07/%E9%BB%91%E7%A5%9E%E8%AF%9D_%E6%82%9F%E7%A9%BA_%E7%B4%A7%E7%AE%8D_4k%E9%AB%98%E6%B8%85%E5%A3%81%E7%BA%B8_3840x2160_%E5%BD%BC%E5%B2%B8%E5%9B%BE%E7%BD%91.jpg" alt="image"></p>
<h3 id="Embedding的重要性"><a href="#Embedding的重要性" class="headerlink" title="Embedding的重要性"></a>Embedding的重要性</h3><p>它建立了一座桥梁，连接了人类语言的丰富多彩与算法的冷冰冰的计算效率。<br>算法擅长数字游戏，却不通人情，而通过文本向量化，它们仿佛获得了解读和处理语言的新技能。其应用范围广泛，从推荐触动人心的内容，到让聊天机器人更具人情味，再到在浩瀚的文本海洋中寻找微妙的规律，文本向量化无处不在。<br>文本向量化 让机器能够进行情感分析、语言转换等看似高深的任务，以一种越来越接近人类的方式来理解和处理语言。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/06/image-6.png" alt="image"><br>这个图的左边，我们看的每一列（维)的数字代表一种特征，比如有代表是否是人类，年龄，性别等。</p>
<p>在二维平面里用图形化表示，我们可以理解Embeddings就是在x和y上的坐标，相同的类会聚集在一起，但是为什么又叫做向量或者矢量，矢量是代表有方向的。我们看的男人和女，与国王和女王线是平行的。<br>说明沿着这条线的方向就代表性别的强度。越往右上角越代表越女性化。当维度越多，表征就更多，代表的语义就更加丰富。<br>演示地址：<a href="https://projector.tensorflow.org/?ref=mlq.ai" target="_blank" rel="noopener">https://projector.tensorflow.org/?ref=mlq.ai</a></p>
<h3 id="向量之间的距离"><a href="#向量之间的距离" class="headerlink" title="向量之间的距离"></a>向量之间的距离</h3><p>向量可能非常长且复杂。例如，OpenAI 的向量大小通常为 1536，这意味着每个Embeddings都是 1536 个浮点数的数组。就其本身而言，这些数据并没有多大意义：它只是为了找到其他接近的Embeddings。<br><img src="http://www.enmalvi.com/wp-content/uploads/2024/06/image-7.png" alt="image"><br>当我们将图像或文本片段表示为向量嵌入时，它们的语义相似性由它们的向量在向量空间中的接近程度来表示。</p>
<p>因此，我们想要查看的是对象向量之间的距离。这些向量表示（嵌入）通常是根据输入数据和任务通过训练模型创建的。</p>
<p>Word2Vec、GLoVE、USE 等是从文本数据生成嵌入的流行模型，而像 VGG 这样的 CNN 模型通常用于创建图像嵌入。</p>
<p>我们之前提到，我们通过计算对象向量之间的距离来发现对象之间的相似性。</p>
<p>我们可以根据最适合我们问题的距离度量来计算向量空间中这些向量之间的距离。<br>相关距离计算方式可以参考我们之前的文章《机器学习中的距离计算》，里面介绍了<strong>欧几里德距离度量、曼哈顿距离度量、余弦距离度量、切比雪夫距离度量</strong>等常用的距离计算方式。</p>
<h3 id="如何选择嵌入模型"><a href="#如何选择嵌入模型" class="headerlink" title="如何选择嵌入模型 "></a><strong>如何选择嵌入模型 </strong></h3><h4 id="常见的类Embbedding模型"><a href="#常见的类Embbedding模型" class="headerlink" title="常见的类Embbedding模型"></a>常见的类Embbedding模型</h4><ul>
<li>检索用Embbedding</li>
<li>重排序用Embbedding</li>
</ul>
<h4 id="Embbedding模型在RAG种的应用场景"><a href="#Embbedding模型在RAG种的应用场景" class="headerlink" title="Embbedding模型在RAG种的应用场景"></a>Embbedding模型在RAG种的应用场景</h4><ul>
<li>知识库存入向量数据库之前，需要使用Embbedding模型</li>
<li>用户提问时的问题，需要使用使用Embbedding模型</li>
<li>检索完成之后重排序的时候，需要 Rank Embbedding模型</li>
</ul>
<h4 id="在哪里找到合适Embbedding模型？"><a href="#在哪里找到合适Embbedding模型？" class="headerlink" title="在哪里找到合适Embbedding模型？"></a>在哪里找到合适Embbedding模型？</h4><p><a href="https://huggingface.co/spaces/mteb/leaderboard" target="_blank" rel="noopener"><strong>MTEB</strong></a> 被公认为是目前业界最全面、最权威的中文语义向量评测基准之一，涵盖了分类、聚类、检索、排序、文本相似度、STS等6个经典任务，共计35个数据集，为深度测试中文语义向量的全面性和可靠性提供了可靠的实验平台。通过这个网站可以看到所有开源的<strong>语义向量模型</strong>： </p>
<h4 id="Embbedding模型选型"><a href="#Embbedding模型选型" class="headerlink" title="Embbedding模型选型"></a>Embbedding模型选型</h4><p>说了那么多的模型，怎么选择一个好的Embbedding模型，它是由很多个维度可以选择的，首先要考虑几个公共的维度，然后还需要考虑场景，因为不同的Embbedding模型训练的语料不一样，业务数据与Embbedding模型训练的语料匹配度越高，效果越佳。</p>
<ul>
<li><strong>Retrieval Average</strong>： NDCG是衡量检索系统性能的常用指标。 NDCG 较高表示模型能够更好地在检索结果列表中将相关项目排名靠前。</li>
<li><strong>模型大小</strong>：模型的大小（以 GB 为单位）。它给出了运行模型所需的计算资源的概念。虽然检索性能随模型大小而变化，但值得注意的是，模型大小也会对延迟产生直接影响。在生产设置中，延迟与性能的权衡变得尤为重要。</li>
<li><strong>最大令牌数</strong>：可以压缩为单个嵌入的令牌数。您通常不想放置超过一个文本段落（~100 个代币) 到单个嵌入中。因此，即使模型的最大令牌数为 512，也应该绰绰有余。</li>
<li><strong>Embbedding维度</strong>：嵌入向量的长度。较小的嵌入可提供更快的推理，并且存储效率更高，而更多的维度可以捕获数据中的细微细节和关系。最终，我们希望在捕获数据的复杂性和运营效率之间取得良好的权衡。</li>
<li><strong>支持的语言 (Languages)</strong>: 中文 (zh)，英文 (en) 等</li>
</ul>
<h4 id="嵌入是如何生成的"><a href="#嵌入是如何生成的" class="headerlink" title="嵌入是如何生成的"></a>嵌入是如何生成的</h4><p>方式一：模型托管方式生成 嵌入：比如一些MaaS(模型即服务)服务厂商会提供嵌入模型的API，比如OpenAI的text-embedding-3-large</p>
<p>方式二：自己部署模型生成 嵌入：另外一种是使用开源的嵌入模型，然后通过使用GPU服务器运行起来，自己封装接口。</p>
<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><p><a href="http://www.enmalvi.com/2024/06/05/langchain-rag-1/#da_xing_yu_yan_mo_xing_si_yao_su" target="_blank" rel="noopener">LangChain+RAG—构建知识库（一）</a><br><a href="http://www.enmalvi.com/2024/06/05/langchain-rag-2/" target="_blank" rel="noopener">LangChain+RAG—构建知识库（二）</a></p>

      
    </div>
    
    
    

    
      <div>
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      </div>
    
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/LLM/" rel="tag"><i class="fa fa-tag"></i> LLM</a>
          
            <a href="/tags/RAG/" rel="tag"><i class="fa fa-tag"></i> RAG</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/02.开发-25.LLM-算法知识/4011.大模型-编程基础-pytorch-张量运算/" rel="next" title="大模型-编程基础 pytorch进行张量运算">
                <i class="fa fa-chevron-left"></i> 大模型-编程基础 pytorch进行张量运算
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/02.开发-25.LLM-算法知识/5022.大模型-模型优化-RAG-01.最新研究进展/" rel="prev" title="大模型-检索增强生成(RAG)">
                大模型-检索增强生成(RAG) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNTI3OS8xMTgxNQ"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="Ben-air" />
          <p class="site-author-name" itemprop="name">Ben-air</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">466</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">97</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">143</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Ben-unbelieveable" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="your-twitter-url" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                    
                      Twitter
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="2432065975" target="_blank" title="Wechat">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      Wechat
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="your-weibo-url" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="your-douban-url" target="_blank" title="DouBan">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      DouBan
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/dan-mo-39/activities" target="_blank" title="ZhiHu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      ZhiHu
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#RAG的优势"><span class="nav-number">1.</span> <span class="nav-text">RAG的优势</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#大模型面临的挑战"><span class="nav-number">1.1.</span> <span class="nav-text">大模型面临的挑战</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAG-解决的问题"><span class="nav-number">1.2.</span> <span class="nav-text">RAG 解决的问题:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAG的关键优势："><span class="nav-number">1.3.</span> <span class="nav-text">RAG的关键优势：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAG和微调方法的异同"><span class="nav-number">1.4.</span> <span class="nav-text">RAG和微调方法的异同</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RAG-技术原理"><span class="nav-number">2.</span> <span class="nav-text">RAG 技术原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#索引"><span class="nav-number">2.1.</span> <span class="nav-text">索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检索与生成"><span class="nav-number">2.2.</span> <span class="nav-text">检索与生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAG系统的主要组件和工作流程"><span class="nav-number">2.3.</span> <span class="nav-text">RAG系统的主要组件和工作流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#检索引擎：数据的精准定位"><span class="nav-number">2.3.1.</span> <span class="nav-text">检索引擎：数据的精准定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增强引擎：上下文的深度融合"><span class="nav-number">2.3.2.</span> <span class="nav-text">增强引擎：上下文的深度融合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成引擎：智能响应的构建"><span class="nav-number">2.3.3.</span> <span class="nav-text">生成引擎：智能响应的构建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAG工作流程的全景视图"><span class="nav-number">2.4.</span> <span class="nav-text">RAG工作流程的全景视图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一步，数据索引：构建检索的基石"><span class="nav-number">2.4.0.1.</span> <span class="nav-text">第一步，数据索引：构建检索的基石</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二步，输入查询处理：理解并转化用户需求"><span class="nav-number">2.4.0.2.</span> <span class="nav-text">第二步，输入查询处理：理解并转化用户需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三步，搜索和排名：找到最相关的信息"><span class="nav-number">2.4.0.3.</span> <span class="nav-text">第三步，搜索和排名：找到最相关的信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第四步，提示增强：丰富输入，提升输出"><span class="nav-number">2.4.0.4.</span> <span class="nav-text">第四步，提示增强：丰富输入，提升输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第五步，响应生成：构建最终答案"><span class="nav-number">2.4.0.5.</span> <span class="nav-text">第五步，响应生成：构建最终答案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第六步，评估：持续优化的关键"><span class="nav-number">2.4.0.6.</span> <span class="nav-text">第六步，评估：持续优化的关键</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAG范式"><span class="nav-number">2.5.</span> <span class="nav-text">RAG范式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一阶段，朴素RAG"><span class="nav-number">2.5.1.</span> <span class="nav-text">第一阶段，朴素RAG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二阶段，高级RAG"><span class="nav-number">2.5.2.</span> <span class="nav-text">第二阶段，高级RAG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三阶段，模块化RAG"><span class="nav-number">2.5.3.</span> <span class="nav-text">第三阶段，模块化RAG</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#新模块"><span class="nav-number">2.5.3.1.</span> <span class="nav-text">新模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模块化-RAG-的优势"><span class="nav-number">2.5.3.2.</span> <span class="nav-text">模块化 RAG 的优势</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RAG-场景对向量数据库的需求"><span class="nav-number">3.</span> <span class="nav-text">RAG 场景对向量数据库的需求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#可选的向量数据库"><span class="nav-number">3.1.</span> <span class="nav-text">可选的向量数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pinecone"><span class="nav-number">3.1.1.</span> <span class="nav-text">Pinecone</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Weaviate"><span class="nav-number">3.1.2.</span> <span class="nav-text">Weaviate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Qdrant"><span class="nav-number">3.1.3.</span> <span class="nav-text">Qdrant</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Milvus-Zilliz"><span class="nav-number">3.1.4.</span> <span class="nav-text">Milvus/Zilliz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chroma"><span class="nav-number">3.1.5.</span> <span class="nav-text">Chroma</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LanceDB"><span class="nav-number">3.1.6.</span> <span class="nav-text">LanceDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vespa"><span class="nav-number">3.1.7.</span> <span class="nav-text">Vespa</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是Embedding"><span class="nav-number">3.2.</span> <span class="nav-text">什么是Embedding</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Embedding的重要性"><span class="nav-number">3.2.1.</span> <span class="nav-text">Embedding的重要性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#向量之间的距离"><span class="nav-number">3.2.2.</span> <span class="nav-text">向量之间的距离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何选择嵌入模型"><span class="nav-number">3.2.3.</span> <span class="nav-text">如何选择嵌入模型 </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#常见的类Embbedding模型"><span class="nav-number">3.2.3.1.</span> <span class="nav-text">常见的类Embbedding模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Embbedding模型在RAG种的应用场景"><span class="nav-number">3.2.3.2.</span> <span class="nav-text">Embbedding模型在RAG种的应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在哪里找到合适Embbedding模型？"><span class="nav-number">3.2.3.3.</span> <span class="nav-text">在哪里找到合适Embbedding模型？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Embbedding模型选型"><span class="nav-number">3.2.3.4.</span> <span class="nav-text">Embbedding模型选型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#嵌入是如何生成的"><span class="nav-number">3.2.3.5.</span> <span class="nav-text">嵌入是如何生成的</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#references"><span class="nav-number">4.</span> <span class="nav-text">references</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ben-air</span>
</div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
      已有<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人访问
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
      总访问<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
